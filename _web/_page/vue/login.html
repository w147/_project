<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>钉钉登录</title>
	<script src="https://cdn.staticfile.org/vue/2.4.2/vue.min.js"/></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"/></script>
	<script src="https://cdnjs.com/libraries/crypto-js"/></script>
</head>
<body>
	<div id="vue_det">
		<h1>code : {{code}}</h1>
		<input type="button" value="post" @click="getUrlParam">
		<input type="button" value="get"@click="getReq">
	</div>
	<script type="text/javascript">
		var vm = new Vue({
			el: '#vue_det',
			data: {
				search: window.location.search,
				code: "",
			},
			methods: {
				getUrlParam: function() {
					var reg = new RegExp("(^|&)code=([^&]*)(&|$)");
					var r = this.search.substr(1).match(reg);
					this.code = r[2]
					console.info(r[2])

					let ts = Date.now()
					let url = `https://oapi.dingtalk.com/sns/getuserinfo_bycode`
					url += `?accessKey=dingoaqsnlymj4cduwtzf3`
					url += `&timestamp=${ts}`
					url += `&signature=${Date.now()}`

					//此处只能是"Message"，不然会加密结果不对
					// var hash = CryptoJS.HmacSHA256("Message", ts);
					// var hashInBase64 = CryptoJS.enc.Base64.stringify(hash);
					// console.log(hashInBase64)

					// Mac mac = Mac.getInstance("HmacSHA256");
					// mac.init(new SecretKeySpec(appSecret.getBytes("UTF-8"), "HmacSHA256"));
					// byte[] signatureBytes = mac.doFinal(stringToSign.getBytes("UTF-8"));
					// String signature = new String(Base64.encodeBase64(signatureBytes));
					// String urlEncodeSignature = urlEncode(signature);

					axios.post(url,{tmp_auth_code: r[2]})
					.then(function(response){
						console.log(response.data)
					})
				},
				getReq: function(){
					axios.get("https://dev.plaso.cn/sudoku/test")
					.then(function(response){
						console.log(response.data)
					},function(err){
						console.log(err)
					})
				},
			}
		})
	</script>
</body>
</html>